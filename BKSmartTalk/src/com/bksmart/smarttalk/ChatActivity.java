package com.bksmart.smarttalk;import java.net.URLEncoder;import java.util.ArrayList;import org.json.JSONException;import org.json.JSONObject;import android.os.Bundle;import android.support.v4.app.FragmentActivity;import android.util.Log;import android.view.View;import android.view.View.OnClickListener;import android.view.View.OnFocusChangeListener;import android.widget.Button;import android.widget.EditText;import android.widget.ListView;import com.android.volley.Response;import com.android.volley.VolleyError;import com.android.volley.VolleyLog;import com.android.volley.toolbox.JsonObjectRequest;import com.bksmart.smarttalk.adapter.ItemChatAdapter;import com.bksmart.smarttalk.models.ItemChat;import com.bksmart.smarttalk.volleyhttp.VolleyService;import com.bksmart.smarttalk.volleyhttp.VolleySingleton;public class ChatActivity extends FragmentActivity implements OnClickListener {	private ListView listView;	private EditText etInput;	private Button btSend;	private ItemChatAdapter chatAdapter;	private ArrayList<ItemChat> list;	@Override	protected void onCreate(Bundle arg0) {		super.onCreate(arg0);		setContentView(R.layout.layout_chat);		listView = (ListView) findViewById(R.id.layout_chat_listview);		etInput = (EditText) findViewById(R.id.layout_chat_edittext);		btSend = (Button) findViewById(R.id.layout_chat_btSend);		btSend.setOnClickListener(this);		list = GetData();		chatAdapter = new ItemChatAdapter(list, getApplicationContext());		listView.setAdapter(chatAdapter);		scrollMyListViewToBottom();	}	@Override	public void onClick(View v) {		if (v.getId() == R.id.layout_chat_btSend) {			Log.d("BtSend", "Click");			String massage = etInput.getText().toString();			etInput.setText("");			if (!massage.equals("")) {				list.add(new ItemChat(1, System.currentTimeMillis(), massage, 1,0));				chatAdapter.notifyDataSetChanged();				scrollMyListViewToBottom();				sendMessage(massage);			}		}	}	private ArrayList<ItemChat> GetData() {		ArrayList<ItemChat> data = new ArrayList<ItemChat>();		ItemChat ti = new ItemChat();//		data.add(new ItemChat(1, 1404139584808L, "What are you doing?", 1,0));//		data.add(new ItemChat(1, 1404139584808L,//				"Im watching televition. wtf?", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "Nothing, i only ask you.", 1,0));//		data.add(new ItemChat(1, 1404139584808L, "Ok. I watch continue", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "What are you doing?", 1,0));//		data.add(new ItemChat(1, 1404139584808L,//				"Im watching televition. wtf?", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "Nothing, i only ask you.", 1,0));//		data.add(new ItemChat(1, 1404139584808L, "Ok. I watch continue", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "What are you doing?", 1,0));//		data.add(new ItemChat(1, 1404139584808L,//				"Im watching televition. wtf?", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "Nothing, i only ask you.", 1,0));//		data.add(new ItemChat(1, 1404139584808L, "Ok. I watch continue", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "What are you doing?", 1,0));//		data.add(new ItemChat(1, 1404139584808L,//				"Im watching televition. wtf?", 0,1));//		data.add(new ItemChat(1, 1404139584808L, "Nothing, i only ask you.", 1,0));//		data.add(new ItemChat(1, 1404139584808L, "Ok. I watch continue", 0,1));		return data;	}	private void scrollMyListViewToBottom() {		listView.post(new Runnable() {			@Override			public void run() {				// Select the last row so it will scroll into view...				listView.setSelection(list.size() - 1);			}		});	}	private void sendMessage(String mess) {		VolleySingleton				.getInstance()				.getRequestQueue()				.add(new JsonObjectRequest(						"http://tech.fpt.com.vn/AIML/api/bots/"								+ BKSmartApplication.smart_en								+ "/chat?request=" + URLEncoder.encode(mess)								+ "&token=" + BKSmartApplication.token, null,						new Response.Listener<JSONObject>() {							@Override							public void onResponse(JSONObject result) {								Log.d("Result", result.toString());								try {									if (result.has("status")											&& result.getString("status")													.equals("success")) {										list.add(new ItemChat(1, System												.currentTimeMillis(), result												.getString("response"), 0,1));										chatAdapter.notifyDataSetChanged();										scrollMyListViewToBottom();										Log.d("Sucess", "Updated");									}								} catch (JSONException e) {									// TODO Auto-generated catch block									e.printStackTrace();								}							}						}, new Response.ErrorListener() {							@Override							public void onErrorResponse(VolleyError error) {								VolleyLog.e("Volley ErrorResponse: ",										error.getMessage());								list.add(new ItemChat(1, System										.currentTimeMillis(), "Sorry,I'm being busy.", 0,1));								chatAdapter.notifyDataSetChanged();								scrollMyListViewToBottom();							}						}));	}}